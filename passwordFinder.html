<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>비밀번호 찾기 - 갓겜판독기</title>
  <style>
    /* --- Pop Art 테마 변수 --- */
    :root {
        --bg-color: #FFDE59;       /* 배경: 쨍한 노란색 */
        --card-bg: #FFFFFF;        /* 카드: 흰색 */
        --ink: #000000;            /* 텍스트: 검정 */
        --brand: #54C1FF;          /* 포인트: 파란색 */
        --accent-pink: #FF90E8;    /* 강조: 핑크 */
        --accent-red: #FF4D4D;     /* 에러: 빨강 */
        --border-w: 3px;           /* 테두리 두께 */
        --shadow-hard: 6px 6px 0px 0px #000000; /* 딱딱한 그림자 */
    }

    html, body { height: 100%; margin: 0; }
    
    body {
      min-height: 100vh;
      display: flex; justify-content: center; align-items: center;
      background-color: var(--bg-color);
      /* 도트 패턴 배경 */
      background-image: radial-gradient(#000 1px, transparent 1px);
      background-size: 20px 20px;
      font-family: 'Pretendard', -apple-system, system-ui, sans-serif;
      color: var(--ink);
    }

    /* 메인 카드 */
    .card {
      width: min(90vw, 420px);
      padding: 40px 30px;
      background: var(--card-bg);
      border: var(--border-w) solid #000;
      box-shadow: var(--shadow-hard);
      border-radius: 0; /* 각진 모서리 */
      position: relative;
    }

    /* 상단 장식 */
    .card::before {
        content: "FIND PW";
        position: absolute;
        top: -18px; left: 20px;
        background: var(--accent-pink);
        border: 2px solid #000;
        padding: 4px 10px;
        font-weight: 900; font-size: 14px;
        box-shadow: 3px 3px 0 #000;
        transform: rotate(-2deg);
        z-index: 1;
    }

    .title {
      margin: 0 0 24px;
      font-size: 28px;
      font-weight: 900;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: -0.5px;
    }

    .field { display: grid; gap: 10px; margin-bottom: 20px; }
    
    label {
      font-size: 16px; font-weight: 800;
      background: var(--brand);
      display: inline-block; width: fit-content;
      padding: 2px 8px; border: 2px solid #000;
      box-shadow: 2px 2px 0 #000;
    }

    *, *::before, *::after { box-sizing: border-box; }
    
    input[type="text"], input[type="email"] {
      width: 100%; display: block; padding: 12px 14px;
      border: 2px solid #000; border-radius: 0;
      font-size: 16px; font-weight: 600; outline: none;
      background: #fff; box-shadow: 3px 3px 0 #eee;
      transition: all 0.15s;
    }
    input:focus {
        background: #fffff0;
        box-shadow: 4px 4px 0 #000;
        transform: translate(-2px, -2px);
    }

    .actions { display: flex; gap: 12px; margin-top: 10px; }
    
    button {
      flex: 1; padding: 14px; border: 2px solid #000; border-radius: 0;
      font-weight: 900; font-size: 16px; cursor: pointer;
      box-shadow: 4px 4px 0 #000; transition: all 0.1s;
      text-transform: uppercase;
    }
    
    button:not(.secondary) {
        background: var(--brand); color: #000;
    }
    button:not(.secondary):hover {
        background: #40b0ee; transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0 #000;
    }
    
    button.secondary {
        background: #fff; color: #000;
    }
    button.secondary:hover {
        background: #f0f0f0; transform: translate(-2px, -2px);
        box-shadow: 6px 6px 0 #000;
    }
    
    button:active {
        transform: translate(2px, 2px);
        box-shadow: 2px 2px 0 #000;
    }

    .err {
        font-size: 14px; color: var(--ink); background: var(--accent-red);
        padding: 8px; border: 2px solid #000; font-weight: 700;
        display: none; margin-top: 10px; text-align: center;
        box-shadow: 3px 3px 0 #000;
    }

    /* 결과 화면 스타일 */
    .summary {
        background: #f9f9f9; border: 2px solid #000;
        padding: 20px; margin-bottom: 20px;
        font-size: 16px; box-shadow: 3px 3px 0 #ddd;
    }
    .summary .kv { 
        display: flex; justify-content: space-between; align-items: center; 
    }
    .summary span { font-weight: 700; color: #555; }
    .summary b { 
        font-weight: 900; font-size: 20px; background: var(--bg-color); 
        padding: 2px 8px; border: 2px solid #000;
    }

    /* [추가] 하단 링크 스타일 (로그인 페이지와 통일) */
    .links {
      margin-top: 20px;
      text-align: center;
      font-size: 14px;
      font-weight: 700;
    }
    .links a { 
        color: #000; 
        text-decoration: none; 
        border-bottom: 2px solid transparent;
        transition: border-color 0.2s;
    }
    .links a:hover { 
        color: var(--brand);
        border-bottom: 2px solid var(--brand);
    }

    [hidden] { display: none !important; }
  </style>
</head>
<body>
  <div class="card">
    <section id="step1">
      <h2 class="title">비밀번호 찾기</h2>

      <div class="field">
        <label for="semail">이메일</label>
        <input id="semail" type="email" placeholder="가입한 이메일 주소" autocomplete="email" required>
        <div id="emailErr" class="err">이메일 형식을 확인해주세요!</div>
      </div>

      <div class="actions">
        <button id="nextBtn" type="button">확인</button>
        <button id="resetBtn" class="secondary" type="button">지우기</button>
      </div>
      
      <div class="links">
        <a href="login.html">← 로그인으로 돌아가기</a>
      </div>

      <div id="matchErr" class="err">일치하는 계정이 없습니다.</div>
    </section>

    <section id="result" hidden>
      <h2 class="title">확인 결과</h2>
      <div class="summary">
        <div class="kv">
            <span>비밀번호:</span>
            <b id="outPwd"></b>
        </div>
      </div>
      <div class="actions">
        <button class="secondary" type="button" id="backBtn">뒤로 가기</button>
        <button type="button" onclick="location.href='login.html'">로그인 하러가기</button>
      </div>
    </section>
  </div>

  <script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js'

  // ✅ 여기에 본인 Supabase 정보 입력
  const supabaseUrl = 'https://qjusboguowpyamitokjh.supabase.co'
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqdXNib2d1b3dweWFtaXRva2poIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwNjU5MDIsImV4cCI6MjA3NTY0MTkwMn0._AMM8U_rwX6RLAe1ACIvdC-047nnykVaQvnfcAuXZ0Q' // 익명 키(클라이언트용)
  const supabase = createClient(supabaseUrl, supabaseKey)

  const nextBtn = document.getElementById('nextBtn');
  const semail = document.getElementById('semail');
  const emailErr = document.getElementById('emailErr');
  const matchErr = document.getElementById('matchErr');
  const resultSection = document.getElementById('result');
  const step1Section = document.getElementById('step1');
  const outPwd = document.getElementById('outPwd'); 
  const resetBtn = document.getElementById('resetBtn');
  const backBtn = document.getElementById('backBtn');

  // 이메일 정규식
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

  nextBtn.onclick = async () => {
    // 초기화
    emailErr.style.display = 'none';
    matchErr.style.display = 'none';
    outPwd.textContent = '';

    const emailValue = semail.value.trim();
    
    if (!emailValue) {
        emailErr.textContent = '이메일을 입력해주세요.';
        emailErr.style.display = 'block';
        return;
    }

    if (!emailRegex.test(emailValue)) {
      emailErr.textContent = '올바른 이메일 형식이 아닙니다.';
      emailErr.style.display = 'block';
      return;
    }

    try {
      // Users 테이블에서 password 조회 (email 컬럼 기준)
      const { data, error } = await supabase
        .from('Users')
        .select('password')
        .eq('email', emailValue)
        .maybeSingle(); 

      if (error) {
        console.error('Supabase error:', error);
        matchErr.textContent = '서버 에러가 발생했습니다.';
        matchErr.style.display = 'block';
        return;
      }

      if (!data) {
        // 일치하는 계정 없음
        matchErr.textContent = '가입되지 않은 이메일입니다.';
        matchErr.style.display = 'block';
        return;
      }

      // 비밀번호 표시
      const pwd = data.password;
      step1Section.hidden = true;
      resultSection.hidden = false;
      outPwd.textContent = pwd;

    } catch (err) {
      console.error(err);
      matchErr.textContent = '예기치 못한 오류가 발생했습니다.';
      matchErr.style.display = 'block';
    }
  }

  resetBtn.onclick = () => {
    semail.value = '';
    emailErr.style.display = 'none';
    matchErr.style.display = 'none';
    semail.focus();
  }

  backBtn.onclick = () => {
    step1Section.hidden = false;
    resultSection.hidden = true;
    semail.value = ''; // 돌아가면 입력창 비우기 (선택사항)
    semail.focus();
  }
  </script>
</body>
</html>