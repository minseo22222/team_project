<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Can You Run It? - ì‚¬ì–‘ ì²´í¬ í”„ë¡œì íŠ¸</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        body { font-family: 'Malgun Gothic', sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; background-color: #f4f4f4; }
        h2 { text-align: center; color: #333; }
        .container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        
        /* ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ */
        .search-box { display: flex; gap: 5px; margin-bottom: 10px; }
        input[type="text"] { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background: #0056b3; }
        
        /* ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .result-list { border: 1px solid #eee; max-height: 150px; overflow-y: auto; background: #fff; border-radius: 5px; display: none; /* ì²˜ìŒì—” ìˆ¨ê¹€ */ }
        .result-item { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; transition: background 0.2s; }
        .result-item:hover { background-color: #eef7ff; }
        
        /* ì„ íƒëœ í•­ëª© ìŠ¤íƒ€ì¼ */
        .selected-text { margin-top: 10px; font-weight: bold; color: #28a745; }
        
        /* ê²°ê³¼ í™”ë©´ ìŠ¤íƒ€ì¼ */
        .final-result { margin-top: 20px; padding: 15px; border: 2px dashed #ccc; text-align: center; border-radius: 8px; background: #fafafa; }
        .pass { color: #28a745; font-weight: bold; font-size: 1.1em; }
        .fail { color: #dc3545; font-weight: bold; font-size: 1.1em; }
        .game-select { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ddd; }
    </style>
</head>
<body>

    <h2>ğŸ–¥ï¸ ë‚´ ì»´í“¨í„° ì‚¬ì–‘ ì²´í¬</h2>

    <div class="container">
        <h3>1. CPU (í”„ë¡œì„¸ì„œ)</h3>
        <div class="search-box">
            <input type="text" id="cpuInput" placeholder="ì˜ˆ: 5600x, i5-12400">
            <button onclick="searchPart('cpu')">ê²€ìƒ‰</button>
        </div>
        <div id="cpuList" class="result-list"></div> <div id="cpuSelectedText" class="selected-text">ì„ íƒëœ ë¶€í’ˆ ì—†ìŒ</div>
        <input type="hidden" id="myCpuScore" value="0"> </div>

    <div class="container">
        <h3>2. GPU (ê·¸ë˜í”½ì¹´ë“œ)</h3>
        <div class="search-box">
            <input type="text" id="gpuInput" placeholder="ì˜ˆ: RTX 3060, GTX 1060">
            <button onclick="searchPart('gpu')">ê²€ìƒ‰</button>
        </div>
        <div id="gpuList" class="result-list"></div> <div id="gpuSelectedText" class="selected-text">ì„ íƒëœ ë¶€í’ˆ ì—†ìŒ</div>
        <input type="hidden" id="myGpuScore" value="0"> </div>

    <div class="container" style="background-color: #e8f4fd;">
        <h3>3. êµ¬ë™ ì—¬ë¶€ í™•ì¸</h3>
        
        <select id="gameSelect" class="game-select">
            <option value="578080">PUBG: ë°°í‹€ê·¸ë¼ìš´ë“œ</option>
            </select>

        <button onclick="checkCanRun()" style="width: 100%; background: #28a745;">ê²°ê³¼ í™•ì¸í•˜ê¸°</button>
        
        <div id="finalResult" class="final-result">
            ë¶€í’ˆì„ ì„ íƒí•˜ê³  ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.
        </div>
    </div>


    <script>
        // -----------------------------------------------------------
        const SUPABASE_URL = 'https://qjusboguowpyamitokjh.supabase.co'; 
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFqdXNib2d1b3dweWFtaXRva2poIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwNjU5MDIsImV4cCI6MjA3NTY0MTkwMn0._AMM8U_rwX6RLAe1ACIvdC-047nnykVaQvnfcAuXZ0Q'; 
        // -----------------------------------------------------------

        // [ìˆ˜ì •ë¨] ë³€ìˆ˜ëª… ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•´ '_supabase' ì‚¬ìš©
        const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // 1. ë¶€í’ˆ ê²€ìƒ‰ í•¨ìˆ˜ (CPU/GPU ê³µí†µ ì‚¬ìš©)
        async function searchPart(type) {
            const inputId = type + 'Input';     // cpuInput ë˜ëŠ” gpuInput
            const listId = type + 'List';       // cpuList ë˜ëŠ” gpuList
            const tableName = type + '_tb';     // cpu_tb ë˜ëŠ” gpu_tb

            const keyword = document.getElementById(inputId).value;
            const listDiv = document.getElementById(listId);

            if(!keyword) { alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!"); return; }

            listDiv.style.display = 'block';
            listDiv.innerHTML = '<div class="result-item">ê²€ìƒ‰ ì¤‘...</div>';

            // Supabase ê²€ìƒ‰ (ëŒ€ì†Œë¬¸ì ë¬´ì‹œ ILIKE)
            const { data, error } = await _supabase
                .from(tableName)
                .select('*')
                .ilike('model_name', '%' + keyword + '%')
                .order('score', { ascending: false })
                .limit(10);

            if (error) {
                console.error("Supabase Error:", error);
                alert('ì—ëŸ¬ ë°œìƒ! URLê³¼ API Keyë¥¼ í™•ì¸í•˜ì„¸ìš”.');
                return;
            }

            listDiv.innerHTML = ''; // ëª©ë¡ ì´ˆê¸°í™”

            if (!data || data.length === 0) {
                listDiv.innerHTML = '<div class="result-item">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                return;
            }

            // ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ ìƒì„±
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'result-item';
                div.innerHTML = `<strong>${item.model_name}</strong> <br> <span style="font-size:0.8em; color:gray;">ì ìˆ˜: ${item.score}</span>`;
                
                // í´ë¦­ ì´ë²¤íŠ¸ (ì„ íƒ)
                div.onclick = function() {
                    selectPart(type, item.model_name, item.score);
                };
                listDiv.appendChild(div);
            });
        }

        // 2. ë¶€í’ˆ ì„ íƒ í•¨ìˆ˜
        function selectPart(type, name, score) {
            // ì„ íƒëœ ì´ë¦„ í‘œì‹œ
            document.getElementById(type + 'SelectedText').innerText = `âœ… ì„ íƒë¨: ${name}`;
            // ì ìˆ˜ë¥¼ ìˆ¨ê²¨ì§„ inputì— ì €ì¥
            document.getElementById('my' + type.charAt(0).toUpperCase() + type.slice(1) + 'Score').value = score;
            // ê²€ìƒ‰ ëª©ë¡ ìˆ¨ê¸°ê¸°
            document.getElementById(type + 'List').style.display = 'none';
        }

        // 3. ìµœì¢… ë¹„êµ í•¨ìˆ˜
        async function checkCanRun() {
            const myCpuScore = parseInt(document.getElementById('myCpuScore').value);
            const myGpuScore = parseInt(document.getElementById('myGpuScore').value);
            const gameId = document.getElementById('gameSelect').value;
            const resultDiv = document.getElementById('finalResult');

            // ë¶€í’ˆ ì„ íƒ ì—¬ë¶€ ì²´í¬
            if (myCpuScore === 0 || myGpuScore === 0) {
                alert("ë¨¼ì € CPUì™€ ê·¸ë˜í”½ì¹´ë“œë¥¼ ê²€ìƒ‰í•´ì„œ ì„ íƒí•´ì£¼ì„¸ìš”!");
                return;
            }

            resultDiv.innerHTML = "ê²Œì„ ë°ì´í„° ë¶„ì„ ì¤‘...";

            // ì„ íƒí•œ ê²Œì„ì˜ ì ìˆ˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const { data, error } = await _supabase
                .from('game_score_tb')
                .select('*')
                .eq('steam_app_id', gameId)
                .single();

            if (error || !data) {
                console.error(error);
                resultDiv.innerHTML = "<span class='fail'>ê²Œì„ ì ìˆ˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (DBì— í•´ë‹¹ ê²Œì„ IDê°€ ì—†ìŠµë‹ˆë‹¤)</span>";
                return;
            }

            // ì ìˆ˜ ë¹„êµ ë¡œì§
            let cpuStatus = (myCpuScore >= data.min_cpu_score) ? 
                            `<span class="pass">í•©ê²©</span>` : `<span class="fail">ë¶ˆí•©ê²©</span>`;
            
            let gpuStatus = (myGpuScore >= data.min_gpu_score) ? 
                            `<span class="pass">í•©ê²©</span>` : `<span class="fail">ë¶ˆí•©ê²©</span>`;

            let finalVerdict = "";
            if (myCpuScore >= data.min_cpu_score && myGpuScore >= data.min_gpu_score) {
                finalVerdict = `<h3 class="pass" style="margin-top:15px;">ğŸ‰ í”Œë ˆì´ ê°€ëŠ¥! (ìµœì†Œì‚¬ì–‘ ì¶©ì¡±)</h3>`;
            } else {
                finalVerdict = `<h3 class="fail" style="margin-top:15px;">ğŸ˜¢ êµ¬ë™ ë¶ˆê°€ (ì‚¬ì–‘ ë¶€ì¡±)</h3>`;
            }

            // ê²°ê³¼ HTML ì¡°ë¦½
            resultDiv.innerHTML = `
                <h4>[ ë¶„ì„ ê²°ê³¼ ]</h4>
                <p><strong>CPU:</strong> ${cpuStatus} (ë‚´ ì ìˆ˜: ${myCpuScore} / í•„ìš”: ${data.min_cpu_score})</p>
                <p><strong>GPU:</strong> ${gpuStatus} (ë‚´ ì ìˆ˜: ${myGpuScore} / í•„ìš”: ${data.min_gpu_score})</p>
                ${finalVerdict}
            `;
        }
    </script>
</body>
</html>